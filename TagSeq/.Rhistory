---
# title: "Geoduck_TagSeq_DESeq2"
# author: "Samuel Gurr"
# date: "December 29, 2020"
---
# LOAD PACKAGES
library(DESeq2) # note: this was previously installed with the command `BiocManager::install("DESeq2")`
library(ggplot2)
library(pasilla) # note: this was previously installed with the command `BiocManager::install("pasilla")`
library(dplyr)
# SET WORKING DIRECTORY AND LOAD DATA
setwd("C:/Users/samjg/Documents/My_Projects/Pgenerosa_TagSeq_Metabolomics/TagSeq/")
# LOAD DATA
cts <- read.csv(file="HPC_Bioinf/outputs/transcript_count_matrix.csv", sep=',', header=TRUE) # read the output count matrix from prepDE.py
# FORMAT COUNT MATRIX (cts has 2x columns per sample on different lanes - sum counts from unique columns + build matrix)
ncol(cts) # 282 samples (not counting gene ID column) - should be 141 samples, need to sum columns by unique ID
cts.merged <- data.frame(cts[,-1], row.names=cts[,1]) # call new dataframe with first column now as row names, now all row values are numeric
names(cts.merged) <- sapply(strsplit(names(cts.merged), "_"), '[', 1) # split the column names by "_" delimiter  and call the first fielf SG##
cts.merged <- t(rowsum(t(cts.merged), group = colnames(cts.merged), na.rm = T)) # merge all unique columns and sum counts
cts.matrix <-as.matrix(cts.merged, row.names="transcript_id") # call dataframe as matrix
fix(cts.matrix) # view count matrix with abbreviated columns and merged data
ncol(cts.matrix) # 141 samples
nrow(cts.matrix) # 34947 total genes
head(cts.matrix,2)
# MASTER REFERENCE DATA.FRAME
# load data
UT_seq_map <- read.csv(file="20201020_Gurr_TagSeq_UTAustin.csv", sep=',', header=TRUE)
smpl_ref <- read.csv(file="Sample_reference.csv", sep=',', header=TRUE)
treatment_ref <- read.csv(file="Extraction_checklist.csv", sep=',', header=TRUE)
# format and merge to buld master reference dataframe
smpl_ref$Seq_Pos <- paste(smpl_ref$ï..TagSeq_Plate, smpl_ref$TagSeq_Well, sep="_")
smpl_ref <- smpl_ref %>% select(-c("ï..TagSeq_Plate", "TagSeq_Well"))
UT_seq_map$Seq_Pos  <- paste(UT_seq_map$ï..Plate, UT_seq_map$Well, sep="_")
UT_seq_map <- UT_seq_map %>% select(-c("ï..Plate", "Well"))
Seq.Ref <- merge(smpl_ref, UT_seq_map, by = "Seq_Pos")
treatment_ref <- treatment_ref[, c(2:5)]
treatment_ref$Treatment[treatment_ref$Treatment == "Ambient" ] <- "A"
treatment_ref$Treatment[treatment_ref$Treatment == "Elevated" ] <- "E"
treatment_ref <-treatment_ref %>%  rename(Day = Notes)
treatment_ref$Day[treatment_ref$Day == "pre-experiment heath stack rearing" ] <- "Day0"
Mstr.Ref <- merge(Seq.Ref, treatment_ref, by = "Geoduck_ID")
exp.data <- Mstr.Ref[,c("Sample.Name","Treatment", "Day")]
exp.data$Treatment <- factor(exp.data$Treatment)
exp.data$Day <- factor(exp.data$Day)
exp.data <- data.frame(exp.data[,-1], row.names=exp.data[,1])
exp.data.mtx <- as.matrix(exp.data, row.names="Geoduck.ID")
# CKECK THE cts.matrix AND THE exp.data.mtx
exp.data.mtx <- exp.data.mtx[match(colnames(cts.merged),rownames(exp.data.mtx)), ]
all(rownames(exp.data.mtx) %in% colnames(cts.matrix)) # should be TRUE
all(rownames(exp.data.mtx) == colnames(cts.matrix)) # should be TRUE
cts.matrix <- cts.matrix[, rownames(exp.data.mtx)]
all(rownames(exp.data.mtx) == colnames(cts.matrix))  # should be TRUE
# format and merge to buld master reference dataframe
smpl_ref$Seq_Pos <- paste(smpl_ref$ï..TagSeq_Plate, smpl_ref$TagSeq_Well, sep="_")
smpl_ref <- smpl_ref %>% select(-c("ï..TagSeq_Plate", "TagSeq_Well"))
UT_seq_map <- read.csv(file="20201020_Gurr_TagSeq_UTAustin.csv", sep=',', header=TRUE)
smpl_ref <- read.csv(file="Sample_reference.csv", sep=',', header=TRUE)
treatment_ref <- read.csv(file="Extraction_checklist.csv", sep=',', header=TRUE)
# MASTER REFERENCE DATA.FRAME
# format and merge to buld master reference dataframe
smpl_ref$Seq_Pos <- paste(smpl_ref$ï..TagSeq_Plate, smpl_ref$TagSeq_Well, sep="_")
smpl_ref <- smpl_ref %>% select(-c("ï..TagSeq_Plate", "TagSeq_Well"))
UT_seq_map$Seq_Pos  <- paste(UT_seq_map$ï..Plate, UT_seq_map$Well, sep="_")
UT_seq_map <- UT_seq_map %>% select(-c("ï..Plate", "Well"))
Seq.Ref <- merge(smpl_ref, UT_seq_map, by = "Seq_Pos")
treatment_ref[, c(2:5)]
UT_seq_map <- read.csv(file="20201020_Gurr_TagSeq_UTAustin.csv", sep=',', header=TRUE)
smpl_ref <- read.csv(file="Sample_reference.csv", sep=',', header=TRUE)
treatment_ref <- read.csv(file="Extraction_checklist.csv", sep=',', header=TRUE)
# MASTER REFERENCE DATA.FRAME
# format and merge to buld master reference dataframe
smpl_ref$Seq_Pos <- paste(smpl_ref$ï..TagSeq_Plate, smpl_ref$TagSeq_Well, sep="_")
smpl_ref <- smpl_ref %>% select(-c("ï..TagSeq_Plate", "TagSeq_Well"))
UT_seq_map$Seq_Pos  <- paste(UT_seq_map$ï..Plate, UT_seq_map$Well, sep="_")
UT_seq_map <- UT_seq_map %>% select(-c("ï..Plate", "Well"))
Seq.Ref <- merge(smpl_ref, UT_seq_map, by = "Seq_Pos")
treatment_ref[, c(2:7)]
treatment_ref[, c(2:9)]
treatment_ref
UT_seq_map <- read.csv(file="20201020_Gurr_TagSeq_UTAustin.csv", sep=',', header=TRUE)
smpl_ref <- read.csv(file="Sample_reference.csv", sep=',', header=TRUE)
treatment_ref <- read.csv(file="Extraction_checklist.csv", sep=',', header=TRUE)
# MASTER REFERENCE DATA.FRAME
# format and merge to buld master reference dataframe
smpl_ref$Seq_Pos <- paste(smpl_ref$ï..TagSeq_Plate, smpl_ref$TagSeq_Well, sep="_")
smpl_ref <- smpl_ref %>% select(-c("ï..TagSeq_Plate", "TagSeq_Well"))
UT_seq_map$Seq_Pos  <- paste(UT_seq_map$ï..Plate, UT_seq_map$Well, sep="_")
UT_seq_map <- UT_seq_map %>% select(-c("ï..Plate", "Well"))
Seq.Ref <- merge(smpl_ref, UT_seq_map, by = "Seq_Pos")
treatment_ref[, c(2:10)]
treatment_ref <- treatment_ref[, c(3:10)]
treatment_ref
Mstr.Ref <- merge(Seq.Ref, treatment_ref, by = "Geoduck_ID")
exp.data <- Mstr.Ref[,c("Sample.Name","Treatment", "Day")]
exp.data$Treatment <- factor(exp.data$Treatment)
exp.data$Day <- factor(exp.data$Day)
exp.data <- Mstr.Ref[,c("Sample.Name","All_Treatment", "Day")]
exp.data <- Mstr.Ref[,c("Sample.Name","ALL_Treatment", "Day")]
exp.data
treatment_ref[, c(3:10)]
treatment_ref
exp.data <- Mstr.Ref[,c("Sample.Name","ALL_Treatment", "EvA_Treatment", "Day0_Treament", "Day7_Treament", "Day14", "Day21_Treatment", "Day")]
exp.data$Treatment <- factor(exp.data$ALL_Treatment)
##### TREATMENT = Day0_Treament ##### #
# assign 'Treatment' as EvA_Treatment containing only E and A for the Day 0
exp.data$Treatment <- factor(exp.data$EvA_Treatment)
exp.data$Day <- factor(exp.data$Day)
exp.data <- data.frame(exp.data[,-1], row.names=exp.data[,1])
exp.data.mtx <- as.matrix(exp.data, row.names="Geoduck.ID")
# CKECK THE cts.matrix AND THE exp.data.mtx
exp.data.mtx <- exp.data.mtx[match(colnames(cts.merged),rownames(exp.data.mtx)), ]
all(rownames(exp.data.mtx) %in% colnames(cts.matrix)) # should be TRUE
all(rownames(exp.data.mtx) == colnames(cts.matrix)) # should be TRUE
cts.matrix <- cts.matrix[, rownames(exp.data.mtx)]
all(rownames(exp.data.mtx) == colnames(cts.matrix))  # should be TRUE
##### TREATMENT = Day0_Treament ##### #
# assign 'Treatment' as EvA_Treatment containing only E and A for the Day 0
exp.data$Treatment <- factor(exp.data$Day0_Treament)
exp.data$Day <- factor(exp.data$Day)
exp.data <- data.frame(exp.data[,-1], row.names=exp.data[,1])
exp.data.mtx <- as.matrix(exp.data, row.names="Geoduck.ID")
# CKECK THE cts.matrix AND THE exp.data.mtx
exp.data.mtx <- exp.data.mtx[match(colnames(cts.merged),rownames(exp.data.mtx)), ]
all(rownames(exp.data.mtx) %in% colnames(cts.matrix)) # should be TRUE
##### TREATMENT = Day0_Treament ##### #
# assign 'Treatment' as EvA_Treatment containing only E and A for the Day 0
exp.data$Treatment <- factor(exp.data$Day0_Treament)
exp.data$Day <- factor(exp.data$Day)
exp.data <- data.frame(exp.data[,-1], row.names=exp.data[,1])
exp.data
##### TREATMENT = Day0_Treament ##### #
# assign 'Treatment' as EvA_Treatment containing only E and A for the Day 0
exp.data$Day0_Treament <- factor(exp.data$Day0_Treament)
exp.data$Day <- factor(exp.data$Day)
exp.data <- data.frame(exp.data[,-1], row.names=exp.data[,1])
# call all experiment design treatments
exp.data <- Mstr.Ref[,c("Sample.Name","ALL_Treatment", "EvA_Treatment", "Day0_Treament", "Day7_Treament", "Day14", "Day21_Treatment", "Day")]
##### TREATMENT = Day0_Treament ##### #
# assign 'Treatment' as EvA_Treatment containing only E and A for the Day 0
exp.data$Day0_Treament <- factor(exp.data$Day0_Treament)
exp.data$Day <- factor(exp.data$Day)
exp.data <- data.frame(exp.data[,-1], row.names=exp.data[,1])
exp.data.mtx <- as.matrix(exp.data, row.names="Geoduck.ID")
# CKECK THE cts.matrix AND THE exp.data.mtx
exp.data.mtx <- exp.data.mtx[match(colnames(cts.merged),rownames(exp.data.mtx)), ]
all(rownames(exp.data.mtx) %in% colnames(cts.matrix)) # should be TRUE
all(rownames(exp.data.mtx) == colnames(cts.matrix)) # should be TRUE
cts.matrix <- cts.matrix[, rownames(exp.data.mtx)]
all(rownames(exp.data.mtx) == colnames(cts.matrix))  # should be TRUE
# DESeq Data Set (dds) - 'Treatment' as the design
dds.D0 <- DESeqDataSetFromMatrix(countData = cts.matrix,
colData = exp.data.mtx,
design = ~ Treatment)
dds.D0
# DESeq Data Set (dds) - 'Treatment' as the design
dds.D0 <- DESeqDataSetFromMatrix(countData = cts.matrix,
colData = exp.data.mtx,
design = ~ Treatment)
exp.data.mtx
exp.data
##### TREATMENT = Day0_Treament ##### #
# assign 'Treatment' as EvA_Treatment containing only E and A for the Day 0
exp.data$Day0_Treament <- factor(exp.data$Day0_Treament)
exp.data$Day <- factor(exp.data$Day)
exp.data <- data.frame(exp.data[,-1], row.names=exp.data[,1])
# call all experiment design treatments
exp.data <- Mstr.Ref[,c("Sample.Name","ALL_Treatment", "EvA_Treatment", "Day0_Treament", "Day7_Treament", "Day14", "Day21_Treatment", "Day")]
##### TREATMENT = Day0_Treament ##### #
# assign 'Treatment' as EvA_Treatment containing only E and A for the Day 0
exp.data$Day0_Treament <- factor(exp.data$Day0_Treament)
exp.data$Day <- factor(exp.data$Day)
exp.data <- data.frame(exp.data[,-1], row.names=exp.data[,1])
exp.data
exp.data.D0 <- exp.data %>% dplr::select(c('Day', 'Day0_Treament'))
exp.data.D0 <- exp.data %>% dplyr::select(c('Day', 'Day0_Treament'))
exp.data.D0
exp.data.DO <- exp.data %>% dplyr::select(c('Day', 'Day0_Treament'))
exp.data.D0 <- exp.data %>% dplyr::select(c('Day', 'Day0_Treament'))
exp.data.D0 <- data.frame(exp.data.D0[,-1], row.names=exp.data.D0[,1])
# call all experiment design treatments
exp.data <- Mstr.Ref[,c("Sample.Name","ALL_Treatment", "EvA_Treatment", "Day0_Treament", "Day7_Treament", "Day14", "Day21_Treatment", "Day")]
##### TREATMENT = Day0_Treament ##### #
# assign 'Treatment' as EvA_Treatment containing only E and A for the Day 0
exp.data$Day0_Treament <- factor(exp.data$Day0_Treament)
exp.data$Day <- factor(exp.data$Day)
exp.data.D0 <- exp.data %>% dplyr::select(c('Day', 'Day0_Treament'))
exp.data.D0 <- data.frame(exp.data.D0[,-1], row.names=exp.data.D0[,1])
exp.data.D0
exp.data
exp.data.D0 <- exp.data %>% dplyr::select(c('Sample.Name', 'Day', 'Day0_Treament'))
exp.data.D0 <- data.frame(exp.data.D0[,-1], row.names=exp.data.D0[,1])
exp.data.D0.mtx <- as.matrix(exp.data.D0, row.names="Geoduck.ID")
exp.data.D0.mtx
# CKECK THE cts.matrix AND THE exp.data.mtx
exp.data.mtx <- exp.data.mtx[match(colnames(cts.merged),rownames(exp.data.mtx)), ]
all(rownames(exp.data.mtx) %in% colnames(cts.matrix)) # should be TRUE
all(rownames(exp.data.mtx) == colnames(cts.matrix)) # should be TRUE
cts.matrix <- cts.matrix[, rownames(exp.data.mtx)]
all(rownames(exp.data.mtx) == colnames(cts.matrix))  # should be TRUE
# DESeq Data Set (dds) - 'Treatment' as the design
dds.D0 <- DESeqDataSetFromMatrix(countData = cts.matrix,
colData = exp.data.mtx,
design = ~ Treatment)
exp.data.mtx
# DESeq Data Set (dds) - 'Treatment' as the design
dds.D0 <- DESeqDataSetFromMatrix(countData = cts.matrix,
colData = exp.data.D0.mtx,
design = ~ Treatment)
ncol(cts.matrix) == nrow(exp.data.D0.mtx)
exp.data <- exp.data %>% dplyr::select(c('Sample.Name', 'Day', 'ALL_Treatment'))
exp.data <- data.frame(exp.data[,-1], row.names=exp.data[,1])
exp.data.mtx <- as.matrix(exp.data, row.names="Geoduck.ID")
# CKECK THE cts.matrix AND THE exp.data.mtx
exp.data.mtx <- exp.data.mtx[match(colnames(cts.merged),rownames(exp.data.mtx)), ]
all(rownames(exp.data.mtx) %in% colnames(cts.matrix)) # should be TRUE
all(rownames(exp.data.mtx) == colnames(cts.matrix)) # should be TRUE
cts.matrix <- cts.matrix[, rownames(exp.data.mtx)]
all(rownames(exp.data.mtx) == colnames(cts.matrix))  # should be TRUE
# DESeq Data Set (dds) - 'Treatment' as the design
dds.D0 <- DESeqDataSetFromMatrix(countData = cts.matrix,
colData = exp.data.mtx,
design = ~ Treatment)
##### TREATMENT = Day0_Treament ##### #
# assign 'Treatment' as EvA_Treatment containing only E and A for the Day 0
exp.data$ALL_Treatment <- factor(exp.data$ALL_Treatment)
exp.data$Day <- factor(exp.data$Day)
# call all experiment design treatments
exp.data <- Mstr.Ref[,c("Sample.Name","ALL_Treatment", "EvA_Treatment", "Day0_Treament", "Day7_Treament", "Day14", "Day21_Treatment", "Day")]
##### TREATMENT = Day0_Treament ##### #
# assign 'Treatment' as EvA_Treatment containing only E and A for the Day 0
exp.data$ALL_Treatment <- factor(exp.data$ALL_Treatment)
exp.data$Day <- factor(exp.data$Day)
exp.data <- exp.data %>% dplyr::select(c('Sample.Name', 'Day', 'ALL_Treatment'))
exp.data <- data.frame(exp.data[,-1], row.names=exp.data[,1])
exp.data.mtx <- as.matrix(exp.data, row.names="Geoduck.ID")
# CKECK THE cts.matrix AND THE exp.data.mtx
exp.data.mtx <- exp.data.mtx[match(colnames(cts.merged),rownames(exp.data.mtx)), ]
all(rownames(exp.data.mtx) %in% colnames(cts.matrix)) # should be TRUE
all(rownames(exp.data.mtx) == colnames(cts.matrix)) # should be TRUE
cts.matrix <- cts.matrix[, rownames(exp.data.mtx)]
all(rownames(exp.data.mtx) == colnames(cts.matrix))  # should be TRUE
# DESeq Data Set (dds) - 'Treatment' as the design
dds <- DESeqDataSetFromMatrix(countData = cts.matrix,
colData = exp.data.mtx,
design = ~ Treatment)
# DESeq Data Set (dds) - 'Treatment' as the design
dds <- DESeqDataSetFromMatrix(countData = cts.matrix,
colData = exp.data.mtx,
design = ~ ALL_Treatment)
dds
