GO_d7.UP.05<-data.frame(GO_d7.UP.05.a)
colnames(GO_d7.UP.05) <- c("category")
GO_d7.UP.05 <- merge(GO_d7.UP.05, d7.UP.05, by="category") # change here
GO_d7.UP.05 <- GO_d7.UP.05[order(-GO_d7.UP.05$numDEInCat),]
GO_d7.UP.05$term <- as.factor(GO_d7.UP.05$term)
d7_UP_MF <- GO_d7.UP.05 %>%
drop_na(ontology) %>%
mutate(term = fct_reorder(term, (-log10(over_represented_pvalue)) ),
ontology = paste(ontology, 'd7_UP', sep = "_")) %>%
dplyr::filter(ontology %in% ('MF_d7_UP'))
d7_UP_BP <- GO_d7.UP.05 %>%
drop_na(ontology) %>%
mutate(term = fct_reorder(term, (-log10(over_represented_pvalue)) ),
ontology = paste(ontology, 'd7_UP', sep = "_")) %>%
dplyr::filter(ontology %in% ('BP_d7_UP'))
# day 14 UPREGULATED
GO_d14.UP.05.a<-d14.UP.05$category[d14.UP.05$over_represented_pvalue<.05] # change twice here
GO_d14.UP.05<-data.frame(GO_d14.UP.05.a)
colnames(GO_d14.UP.05) <- c("category")
GO_d14.UP.05 <- merge(GO_d14.UP.05, d14.UP.05, by="category") # change here
GO_d14.UP.05 <- GO_d14.UP.05[order(-GO_d14.UP.05$numDEInCat),]
GO_d14.UP.05$term <- as.factor(GO_d14.UP.05$term)
d14_UP_MF <- GO_d14.UP.05 %>%
drop_na(ontology) %>%
mutate(term = fct_reorder(term, (-log10(over_represented_pvalue)) ),
ontology = paste(ontology, 'd14_UP', sep = "_")) %>%
dplyr::filter(ontology %in% ('MF_d14_UP'))
d14_UP_BP <- GO_d14.UP.05 %>%
drop_na(ontology) %>%
mutate(term = fct_reorder(term, (-log10(over_represented_pvalue)) ),
ontology = paste(ontology, 'd14_UP', sep = "_")) %>%
dplyr::filter(ontology %in% ('BP_d14_UP'))
# day 21 UPREGULATED
GO_d21.UP.05.a<-d21.UP.05$category[d21.UP.05$over_represented_pvalue<.05] # change twice here
GO_d21.UP.05<-data.frame(GO_d21.UP.05.a)
colnames(GO_d21.UP.05) <- c("category")
GO_d21.UP.05 <- merge(GO_d21.UP.05, d21.UP.05, by="category") # change here
GO_d21.UP.05 <- GO_d21.UP.05[order(-GO_d21.UP.05$numDEInCat),]
GO_d21.UP.05$term <- as.factor(GO_d21.UP.05$term)
d21_UP_MF <- GO_d21.UP.05 %>%
drop_na(ontology) %>%
mutate(term = fct_reorder(term, (-log10(over_represented_pvalue)) ),
ontology = paste(ontology, 'd21_UP', sep = "_")) %>%
dplyr::filter(ontology %in% ('MF_d21_UP'))
d21_UP_BP <- GO_d21.UP.05 %>%
drop_na(ontology) %>%
mutate(term = fct_reorder(term, (-log10(over_represented_pvalue)) ),
ontology = paste(ontology, 'd21_UP', sep = "_")) %>%
dplyr::filter(ontology %in% ('BP_d21_UP'))
#======================================================================= #
# bind the rows of MF and BP in the clustered modules (those twith primary treatment effect in same pattern/directionality)
MF_UP <- rbind(d0_UP_MF, d7_UP_MF, d14_UP_MF, d21_UP_MF)
BP_UP <- rbind(d0_UP_BP, d7_UP_BP, d14_UP_BP, d21_UP_BP)
MF_UP$term <- gsub(",.*$", "", MF_UP$term)
MF_UP$Day = factor(MF_UP$Day, levels = c("Day0", "Day7", "Day14", "Day21"))
MF_UP_plot <- MF_UP  %>%  mutate(term = fct_reorder(term, -log10(over_represented_pvalue))) %>%
#mutate(term = fct_reorder(term, Day)) %>%
ggplot(aes(x=term, y=-log10(over_represented_pvalue))) +
geom_segment( aes(x=term ,xend=term, y=1, yend=-log10(over_represented_pvalue)), color="grey95", size = 3) +
geom_point(size=3, shape = 15, colour = "grey70") +
coord_flip() +
theme(
panel.grid.minor.y = element_blank(),
panel.grid.major.y = element_blank(),
legend.position="bottom"
) +
xlab("") +
ylab("") +
ggtitle("Molecular Function: Upregulated DEGs Primary Effect (higher by ambient history)") +
#geom_label(aes(x = 0.5, y = 0.5, label = paste(num_up, "DEGs"))) +
theme_bw() + #Set background color
theme(panel.border = element_blank(), # Set border
panel.grid.major = element_blank(), #Set major gridlines
panel.grid.minor = element_blank(), #Set minor gridlines
axis.line = element_line(colour = "black"), #Set axes color
plot.background=element_blank()) + #Set the plot background #set title attributes
#geom_hline(yintercept=0.25, linetype="dashed",  color = "black", size=2) +
facet_wrap(Day ~., scales="free_y", ncol= 1, strip.position="right")
#facet_wrap(~ Day,nrow = 1)
BP_UP$term <- gsub(",.*$", "", BP_UP$term)
BP_UP$Day = factor(BP_UP$Day, levels = c("Day0", "Day7", "Day14", "Day21"))
BP_UP_plot <- BP_UP  %>% mutate(term = fct_reorder(term, -log10(over_represented_pvalue))) %>%
#mutate(term = fct_reorder(term, Day)) %>%
ggplot(aes(x=term, y=-log10(over_represented_pvalue))) +
geom_segment( aes(x=term ,xend=term, y=1, yend=-log10(over_represented_pvalue)), color="grey95", size = 3) +
geom_point(size=3, shape = 15, colour = "grey70") +
coord_flip() +
theme(
panel.grid.minor.y = element_blank(),
panel.grid.major.y = element_blank(),
legend.position="bottom"
) +
xlab("") +
ylab("") +
ggtitle("Biological Process: Upregulated DEGs Primary Effect (higher by ambient history)") +
#geom_label(aes(x = 0.5, y = 0.5, label = paste(num_up, "DEGs"))) +
theme_bw() + #Set background color
theme(panel.border = element_blank(), # Set border
panel.grid.major = element_blank(), #Set major gridlines
panel.grid.minor = element_blank(), #Set minor gridlines
axis.line = element_line(colour = "black"), #Set axes color
plot.background=element_blank()) + #Set the plot background #set title attributes
#geom_hline(yintercept=0.25, linetype="dashed",  color = "black", size=2) +
facet_wrap(Day ~., scales="free_y", ncol= 1, strip.position="right")
# Downregulated plots
# day 0 DOWNREGULATED
GO_d0.DOWN.05.a<-d0.DOWN.05$category[d0.DOWN.05$over_represented_pvalue<.05] # change twice here
GO_d0.DOWN.05<-data.frame(GO_d0.DOWN.05.a)
colnames(GO_d0.DOWN.05) <- c("category")
GO_d0.DOWN.05 <- merge(GO_d0.DOWN.05, d0.DOWN.05, by="category") # change here
GO_d0.DOWN.05 <- GO_d0.DOWN.05[order(-GO_d0.DOWN.05$numDEInCat),]
GO_d0.DOWN.05$term <- as.factor(GO_d0.DOWN.05$term)
d0_DOWN_MF <- GO_d0.DOWN.05 %>%
drop_na(ontology) %>%
mutate(term = fct_reorder(term, (-log10(over_represented_pvalue)) ),
ontology = paste(ontology, 'd0_DOWN', sep = "_")) %>%
dplyr::filter(ontology %in% ('MF_d0_DOWN'))
d0_DOWN_BP <- GO_d0.DOWN.05 %>%
drop_na(ontology) %>%
mutate(term = fct_reorder(term, (-log10(over_represented_pvalue)) ),
ontology = paste(ontology, 'd0_DOWN', sep = "_")) %>%
dplyr::filter(ontology %in% ('BP_d0_DOWN'))
# day 7 DOWNREGULATED
GO_d7.DOWN.05.a<-d7.DOWN.05$category[d7.DOWN.05$over_represented_pvalue<.05] # change twice here
GO_d7.DOWN.05<-data.frame(GO_d7.DOWN.05.a)
colnames(GO_d7.DOWN.05) <- c("category")
GO_d7.DOWN.05 <- merge(GO_d7.DOWN.05, d7.DOWN.05, by="category") # change here
GO_d7.DOWN.05 <- GO_d7.DOWN.05[order(-GO_d7.DOWN.05$numDEInCat),]
GO_d7.DOWN.05$term <- as.factor(GO_d7.DOWN.05$term)
d7_DOWN_MF <- GO_d7.DOWN.05 %>%
drop_na(ontology) %>%
mutate(term = fct_reorder(term, (-log10(over_represented_pvalue)) ),
ontology = paste(ontology, 'd7_DOWN', sep = "_")) %>%
dplyr::filter(ontology %in% ('MF_d7_DOWN'))
d7_DOWN_BP <- GO_d7.DOWN.05 %>%
drop_na(ontology) %>%
mutate(term = fct_reorder(term, (-log10(over_represented_pvalue)) ),
ontology = paste(ontology, 'd7_DOWN', sep = "_")) %>%
dplyr::filter(ontology %in% ('BP_d7_DOWN'))
# day 14 DOWNREGULATED
GO_d14.DOWN.05.a<-d14.DOWN.05$category[d14.DOWN.05$over_represented_pvalue<.05] # change twice here
GO_d14.DOWN.05<-data.frame(GO_d14.DOWN.05.a)
colnames(GO_d14.DOWN.05) <- c("category")
GO_d14.DOWN.05 <- merge(GO_d14.DOWN.05, d14.DOWN.05, by="category") # change here
GO_d14.DOWN.05 <- GO_d14.DOWN.05[order(-GO_d14.DOWN.05$numDEInCat),]
GO_d14.DOWN.05$term <- as.factor(GO_d14.DOWN.05$term)
d14_DOWN_MF <- GO_d14.DOWN.05 %>%
drop_na(ontology) %>%
mutate(term = fct_reorder(term, (-log10(over_represented_pvalue)) ),
ontology = paste(ontology, 'd14_DOWN', sep = "_")) %>%
dplyr::filter(ontology %in% ('MF_d14_DOWN'))
d14_DOWN_BP <- GO_d14.DOWN.05 %>%
drop_na(ontology) %>%
mutate(term = fct_reorder(term, (-log10(over_represented_pvalue)) ),
ontology = paste(ontology, 'd14_DOWN', sep = "_")) %>%
dplyr::filter(ontology %in% ('BP_d14_DOWN'))
# day 21 DOWNREGULATED
GO_d21.DOWN.05.a<-d21.DOWN.05$category[d21.DOWN.05$over_represented_pvalue<.05] # change twice here
GO_d21.DOWN.05<-data.frame(GO_d21.DOWN.05.a)
colnames(GO_d21.DOWN.05) <- c("category")
GO_d21.DOWN.05 <- merge(GO_d21.DOWN.05, d21.DOWN.05, by="category") # change here
GO_d21.DOWN.05 <- GO_d21.DOWN.05[order(-GO_d21.DOWN.05$numDEInCat),]
GO_d21.DOWN.05$term <- as.factor(GO_d21.DOWN.05$term)
d21_DOWN_MF <- GO_d21.DOWN.05 %>%
drop_na(ontology) %>%
mutate(term = fct_reorder(term, (-log10(over_represented_pvalue)) ),
ontology = paste(ontology, 'd21_DOWN', sep = "_")) %>%
dplyr::filter(ontology %in% ('MF_d21_DOWN'))
d21_DOWN_BP <- GO_d21.DOWN.05 %>%
drop_na(ontology) %>%
mutate(term = fct_reorder(term, (-log10(over_represented_pvalue)) ),
ontology = paste(ontology, 'd21_DOWN', sep = "_")) %>%
dplyr::filter(ontology %in% ('BP_d21_DOWN'))
#======================================================================= #
# bind the rows of MF and BP in the clustered modules (those twith primary treatment effect in same pattern/directionality)
MF_DOWN <- rbind(d0_DOWN_MF, d7_DOWN_MF, d14_DOWN_MF, d21_DOWN_MF)
BP_DOWN <- rbind(d0_DOWN_BP, d7_DOWN_BP, d14_DOWN_BP, d21_DOWN_BP)
MF_DOWN$term <- gsub(",.*$", "", MF_DOWN$term)
MF_DOWN$Day = factor(MF_DOWN$Day, levels = c("Day0", "Day7", "Day14", "Day21"))
MF_DOWN_plot <- MF_DOWN  %>% mutate(term = fct_reorder(term, -log10(over_represented_pvalue))) %>%
#mutate(term = fct_reorder(term, Day)) %>%
ggplot(aes(x=term, y=-log10(over_represented_pvalue))) +
geom_segment( aes(x=term ,xend=term, y=1, yend=-log10(over_represented_pvalue)), color="grey95", size = 3) +
geom_point(size=3, shape = 15, colour = "grey70") +
coord_flip() +
theme(
panel.grid.minor.y = element_blank(),
panel.grid.major.y = element_blank(),
legend.position="bottom"
) +
xlab("") +
ylab("") +
ggtitle("Molecular Function: Downregulated DEGs Primary Effect (higher by Moderate history)") +
#geom_label(aes(x = 0.5, y = 0.5, label = paste(num_up, "DEGs"))) +
theme_bw() + #Set background color
theme(panel.border = element_blank(), # Set border
panel.grid.major = element_blank(), #Set major gridlines
panel.grid.minor = element_blank(), #Set minor gridlines
axis.line = element_line(colour = "black"), #Set axes color
plot.background=element_blank()) + #Set the plot background #set title attributes
#geom_hline(yintercept=0.25, linetype="dashed",  color = "black", size=2) +
facet_wrap(Day ~., scales="free_y", ncol= 1, strip.position="right")
BP_DOWN$term <- gsub(",.*$", "", BP_DOWN$term)
BP_DOWN$Day = factor(BP_DOWN$Day, levels = c("Day0", "Day7", "Day14", "Day21"))
BP_DOWN_plot <- BP_DOWN    %>%  mutate(term = fct_reorder(term, -log10(over_represented_pvalue))) %>%
#mutate(term = fct_reorder(term, Day)) %>%
ggplot(aes(x=term, y=-log10(over_represented_pvalue))) +
geom_segment( aes(x=term ,xend=term, y=1, yend=-log10(over_represented_pvalue)), color="grey95", size = 3) +
geom_point(size=3, shape = 15, colour = "grey70") +
coord_flip() +
theme(
panel.grid.minor.y = element_blank(),
panel.grid.major.y = element_blank(),
legend.position="bottom"
) +
xlab("") +
ylab("") +
ggtitle("Biological Process: Downregulated DEGs Primary Effect (higher by Moderate history)") +
#geom_label(aes(x = 0.5, y = 0.5, label = paste(num_up, "DEGs"))) +
theme_bw() + #Set background color
theme(panel.border = element_blank(), # Set border
panel.grid.major = element_blank(), #Set major gridlines
panel.grid.minor = element_blank(), #Set minor gridlines
axis.line = element_line(colour = "black"), #Set axes color
plot.background=element_blank()) + #Set the plot background #set title attributes
#geom_hline(yintercept=0.25, linetype="dashed",  color = "black", size=2) +
facet_wrap(Day ~., scales="free_y", ncol= 1, strip.position="right")
# MOLECULAR FUNCTION GRAPHS OUTPUT
pdf(paste("../Output/GO/DESeq2_goseq/GOplot_DESeq2_PrimEffect_Upregulated_MF.pdf", sep =''), width=10, height=12)
print(ggarrange(MF_UP_plot,
plotlist = NULL,
ncol = 1,
nrow = 1,
labels = NULL))
dev.off()
pdf(paste("../Output/GO/DESeq2_goseq/GOplot_DESeq2_PrimEffect_Downregulated_MF.pdf", sep =''), width=10, height=12)
print(ggarrange(MF_DOWN_plot,
plotlist = NULL,
ncol = 1,
nrow = 1,
labels = NULL))
dev.off()
# BIOLOFICAL PROCESS GRAPHS OUTPUT
pdf(paste("../Output/GO/DESeq2_goseq/GOplot_DESeq2_PrimEffect_Upregulated_BP.pdf", sep =''), width=10, height=18)
print(ggarrange(BP_UP_plot,
plotlist = NULL,
ncol = 1,
nrow = 1,
labels = NULL))
dev.off()
pdf(paste("../Output/GO/DESeq2_goseq/GOplot_DESeq2_PrimEffect_Downregulated_BP.pdf", sep =''), width=10, height=18)
print(ggarrange(BP_DOWN_plot,
plotlist = NULL,
ncol = 1,
nrow = 1,
labels = NULL))
dev.off()
knitr::opts_chunk$set(echo = TRUE)
# load libraries - notes show the install command needed to install (pre installed)
library(goseq)
library(dplyr)
library(forcats)
library(ggplot2)
library(gridExtra)
library(tidyr)
library(grDevices)
library(reshape2)
library(Rmisc)
library(ggpubr)
library(tibble)
library(hrbrthemes)
library(gridExtra)
library(tidyr)
library(zoo)
library(ComplexHeatmap)
library(circlize)
library(GSEABase)
library(data.table)
library(stringr)
### Panopea generosa - load .fna ('Geoduck_annotation') and foramt GO terms ('Geoduck_GOterms') and vectors
Geoduck_annotation <- read.delim2(file="C:/Users/samjg/Documents/My_Projects/Pgenerosa_TagSeq_Metabolomics/TagSeq/Seq_details/Panopea-generosa-genes-annotations.txt", header=F)
# DE files - all genes and filtered raw counts
#  contains boolean for upregulated and downregulated DEGs
# DEGs: Primary Effect  - Ambient_v_Moderate
DE_d0.primary <- read.csv(file="C:/Users/samjg/Documents/My_Projects/Pgenerosa_TagSeq_Metabolomics/TagSeq/Analysis/Output/DESeq2/10cpm/Day0/DE_Day0_Primary.csv", sep=',', header=TRUE)
colnames(DE_d0.primary)[2] <- "gene.ID" # rename Pgen gene ID column
DE_d7.primary <- read.csv(file="C:/Users/samjg/Documents/My_Projects/Pgenerosa_TagSeq_Metabolomics/TagSeq/Analysis/Output/DESeq2/10cpm/Day7/DE_Day7_Primary.csv", sep=',', header=TRUE)
colnames(DE_d7.primary)[2] <- "gene.ID"# rename Pgen gene ID column
DE_d7.second <- read.csv(file="C:/Users/samjg/Documents/My_Projects/Pgenerosa_TagSeq_Metabolomics/TagSeq/Analysis/Output/DESeq2/10cpm/Day7/DE_Day7_Second.csv", sep=',', header=TRUE)
colnames(DE_d7.second)[2] <- "gene.ID"# rename Pgen gene ID column
DE_d7.MA_AM <- read.csv(file="C:/Users/samjg/Documents/My_Projects/Pgenerosa_TagSeq_Metabolomics/TagSeq/Analysis/Output/DESeq2/10cpm/Day7/DE_Day7_MA_AM.csv", sep=',', header=TRUE)
colnames(DE_d7.MA_AM)[2] <- "gene.ID"# rename Pgen gene ID column
DE_d14.primary <- read.csv(file="C:/Users/samjg/Documents/My_Projects/Pgenerosa_TagSeq_Metabolomics/TagSeq/Analysis/Output/DESeq2/10cpm/Day14/DE_Day14_Primary.csv", sep=',', header=TRUE)
colnames(DE_d14.primary)[2] <- "gene.ID"# rename Pgen gene ID column
DE_d21.primary <- read.csv(file="C:/Users/samjg/Documents/My_Projects/Pgenerosa_TagSeq_Metabolomics/TagSeq/Analysis/Output/DESeq2/10cpm/Day21/DE_Day21_Primary.csv", sep=',', header=TRUE)
colnames(DE_d21.primary)[2] <- "gene.ID"# rename Pgen gene ID column
#  mapped read counts for each Day (addressed separately in DESeq2)
# day0 filtered 10cpm in 50% samples
Day0_all.counts <- read.csv(file="C:/Users/samjg/Documents/My_Projects/Pgenerosa_TagSeq_Metabolomics/TagSeq/Analysis/Data/Filtered_Counts/10cpm_50perc/day0.counts.filtered_10cpm50perc.csv", sep=',', header=TRUE)
colnames(Day0_all.counts)[1] <- "gene.ID"# rename Pgen gene ID column
# day7 filtered 10cpm in 50% samples
Day7_all.counts <- read.csv(file="C:/Users/samjg/Documents/My_Projects/Pgenerosa_TagSeq_Metabolomics/TagSeq/Analysis/Data/Filtered_Counts/10cpm_50perc/day7.counts.filtered_10cpm50perc.csv", sep=',', header=TRUE)
colnames(Day7_all.counts)[1] <- "gene.ID"# rename Pgen gene ID column
# day14 filtered 10cpm in 50% samples
Day14_all.counts <- read.csv(file="C:/Users/samjg/Documents/My_Projects/Pgenerosa_TagSeq_Metabolomics/TagSeq/Analysis/Data/Filtered_Counts/10cpm_50perc/day14.counts.filtered_10cpm50perc.csv", sep=',', header=TRUE)
colnames(Day14_all.counts)[1] <- "gene.ID"# rename Pgen gene ID column
# day21 filtered 10cpm in 50% samples
Day21_all.counts <- read.csv(file="C:/Users/samjg/Documents/My_Projects/Pgenerosa_TagSeq_Metabolomics/TagSeq/Analysis/Data/Filtered_Counts/10cpm_50perc/day21.counts.filtered_10cpm50perc.csv", sep=',', header=TRUE)
colnames(Day21_all.counts)[1] <- "gene.ID"# rename Pgen gene ID column
All_DEGs_Primary.Ambieant_v_Moderate<-read.csv("C:/Users/samjg/Documents/My_Projects/Pgenerosa_TagSeq_Metabolomics/TagSeq/Analysis/Output/DESeq2/10cpm/DE_PrimaryTreatment.All.csv")
# GOslim
slim <- getOBOCollection("http://current.geneontology.org/ontology/subsets/goslim_generic.obo") #get GO database - # call goslim_generic.obo terms as 'slim'
DE_d7.second
Geoduck_annotation
Geoduck_annotation[c(1,7),]
ref <- Geoduck_annotation[,c(1,7)]
ref
colnames(ref) <- c("gene.ID", "gene.annotation")
ref
DE_d0.primary
# Day 0 primary
DE_d0.primary
# Day 0 primary
DE_d0.primary_SHORT <- DE_d0.primary %>% select(c("gene.ID", 'log2FoldChange', 'up', 'down'))
# Day 0 primary
DE_d0.primary_SHORT <- DE_d0.primary %>% select("gene.ID", 'log2FoldChange', 'up', 'down')
# Day 0 primary
DE_d0.primary_SHORT <- DE_d0.primary %>% dplyr::select("gene.ID", 'log2FoldChange', 'up', 'down')
DE_d0.primary_SHORT
# Day 0 primary
DE_d0.primary_SHORT <- DE_d0.primary %>% dplyr::select("gene.ID", 'log2FoldChange', 'up', 'down') %>% mutate(Effect = "Day7_primary")
DE_d0.primary_SHORT
# Day 0 primary
DE_d0.primary_SHORT <- DE_d0.primary %>% dplyr::select("gene.ID", 'log2FoldChange', 'up', 'down') %>% mutate(Effect = "Day0_primary")
DE_d0.primary
# Day 0 primary
DE_d7.primary_SHORT <- DE_d7.primary %>% dplyr::select("gene.ID", 'log2FoldChange', 'up', 'down') %>% mutate(Effect = "Day7_primary")
# Day 14 primary
DE_d14.primary_SHORT <- DE_d14.primary %>% dplyr::select("gene.ID", 'log2FoldChange', 'up', 'down') %>% mutate(Effect = "Day7_primary")
# Day 14 primary
DE_d14.primary_SHORT <- DE_d14.primary %>% dplyr::select("gene.ID", 'log2FoldChange', 'up', 'down') %>% mutate(Effect = "Day14_primary")
# Day 21 primary
DE_d21.primary_SHORT <- DE_d21.primary %>% dplyr::select("gene.ID", 'log2FoldChange', 'up', 'down') %>% mutate(Effect = "Day21_primary")
# Day 7 second
DE_d7.second_SHORT <- DE_d7.second%>% dplyr::select("gene.ID", 'log2FoldChange', 'up', 'down') %>% mutate(Effect = "Day7_second")
# Day 7 MA versus AM
DE_d7.MAversusAM_SHORT <- DE_d7.MA_AM %>% dplyr::select("gene.ID", 'log2FoldChange', 'up', 'down') %>% mutate(Effect = "Day7_MAversusAM")
DE_Master <- rbind(DE_d0.primary_SHORT, DE_d7.primary_SHORT, DE_d7.second_SHORT, DE_d7.MAversusAM_SHORT, DE_d14.primary_SHORT, DE_d21.primary_SHORT)
DE_Master
DE_Master_with_annotation <- merge(DE_Master, ref, by="gene.ID")
DE_Master_with_annotation
write.csv(DE_Master_with_annotation, file = "../Output/DESeq2/10cpm/DE_PrimaryTreatment.All_Annotation.csv", row.names = FALSE)
write.csv(DE_Master_with_annotation, file = "../Output/DESeq2/10cpm/DE_All_Annotation.csv", row.names = FALSE)
# LOAD PACKAGES
library(KEGGprofile) # BiocManager::install("KEGGprofile")
library(clusterProfiler)
library(KEGGREST)
library(tidyr)
library(stringr)
library(tidyr)
library(forcats)
library(ggplot2)
library(scales)
# SET WORKING DIRECTORY AND LOAD DATA   ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::;: #
setwd("C:/Users/samjg/Documents/My_Projects/Pgenerosa_TagSeq_Metabolomics/TagSeq/")
# Calland prep the reference annotation file...    :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::;: #
Geoduck_annotation <- read.delim2(file="C:/Users/samjg/Documents/My_Projects/Pgenerosa_TagSeq_Metabolomics/TagSeq/Seq_details/Panopea-generosa-genes-annotations.txt", header=F)
annot.condenced <- Geoduck_annotation[,c(1,7)] # load just the PGEN ID and the putative gene terms
annot.condenced$Gene_term    <- sub(" \\(EC.*", "", annot.condenced$V7)  # call the gene term BEFORe the EC is listed
Pgen_reference <- na.omit(annot.condenced[c(1,3)]) # ommit unannotated genes
names(Pgen_reference)  <- c('Pgenerosa_Gene_IDs', 'Gene_terms') # rename the columns to merge with the modules below...
# PREPARE THE KEGG  Crassostra gigas (Pacific oyster) genome 'Crass_gigas_genome_dataframe' will be called in the KEGG analysis for loops::::::::::::::::::;: #
# Crassostrea gigas - prep for merge with genes of interest (i.e. genes in modules with significant GO enrichment)
#NOTE: view the Pgenerasa genome - there are no instance of '-like', '-like isoform', '-like protein precursor', 'isoform X', 'precursor' at the end of terms,
Crass_gigas_genome <- keggList("crg") #
Crass_gigas_genome
View(Crass_gigas_genome)
ref2 <- read.gff("C:/Users/samjg/Documents/My_Projects/Pgenerosa_TagSeq_Metabolomics/TagSeq/Seq_details/Panopea-generosa-v1.0.a4.gene.gff", GFF3 = TRUE)
library(ape)
ref2 <- read.gff("C:/Users/samjg/Documents/My_Projects/Pgenerosa_TagSeq_Metabolomics/TagSeq/Seq_details/Panopea-generosa-v1.0.a4.gene.gff", GFF3 = TRUE)
ref2 <- read.gff("C:/Users/samjg/Documents/My_Projects/Pgenerosa_TagSeq_Metabolomics/TagSeq/Seq_details/Panopea-generosa-v1.0.a4.gene.gff3", GFF3 = TRUE)
View(ref2)
View(Geoduck_annotation)
ref_update_20210602 <- read.gff("C:/Users/samjg/Documents/My_Projects/Pgenerosa_TagSeq_Metabolomics/TagSeq/Seq_details/Panopea-generosa-v1.0.a4.gene.gff3", GFF3 = TRUE) # use library(ape) to import a gff3 as a datatable
View(ref_update_20210602)
ref_update_20210602$gene_ID  <- gsub("\\=.*?\\;", "",  ref_update_20210602$attributes)
View(ref_update_20210602)
# to cal the gene ID....
# We can use gsub.
# Match the pattern of one or more characters that are not a - ([^-]+) from the start (^) of the string followed by a - or (| a - followed by characters (.*) and replace it with blank ("")
ref_update_20210602$gene_ID  <- gsub("^[^-]+=|;.*", "",  ref_update_20210602$attributes)
View(ref_update_20210602)
# to cal the gene ID....
# We can use gsub.
# Match the pattern of one or more characters that are not a - ([^-]+) from the start (^) of the string followed by a - or (| a - followed by characters (.*) and replace it with blank ("")
ref_update_20210602$gene_ID  <- gsub("^[^-]+ID=|;.*", "",  ref_update_20210602$attributes)
View(ref_update_20210602)
ref_update_20210602 <- read.gff("C:/Users/samjg/Documents/My_Projects/Pgenerosa_TagSeq_Metabolomics/TagSeq/Seq_details/Panopea-generosa-v1.0.a4.gene.gff3", GFF3 = TRUE) # use library(ape) to import a gff3 as a datatable
# to cal the gene ID....
# We can use gsub.
# Match the pattern of one or more characters that are not a - ([^-]+) from the start (^) of the string followed by a - or (| a - followed by characters (.*) and replace it with blank ("")
ref_update_20210602$gene_ID  <- gsub("^[^-]+ID=|;.*", "",  ref_update_20210602$attributes)
View(ref_update_20210602)
# to cal the gene ID....
# We can use gsub.
# Match the pattern of one or more characters that are not a - ([^-]+) from the start (^) of the string followed by a - or (| a - followed by characters (.*) and replace it with blank ("")
ref_update_20210602$gene_ID  <- gsub('^.*ID=\\s*|\\s*;.*$', '',ref_update_20210602$attributes)
View(ref_update_20210602)
# to cal the gene ID....
# We can use gsub.
# Match the pattern of one or more characters that are not a - ([^-]+) from the start (^) of the string followed by a - or (| a - followed by characters (.*) and replace it with blank ("")
ref_update_20210602$gene_ID  <- gsub('^.*ID=\\s*|\\s*;Name.*$', '',ref_update_20210602$attributes)
View(ref_update_20210602)
# to cal the gene ID....
# We can use gsub.
# Match the pattern of one or more characters that are not a - ([^-]+) from the start (^) of the string followed by a - or (| a - followed by characters (.*) and replace it with blank ("")
ref_update_20210602$gene_ID  <- gsub('^.*ID\\s*|\\s*Name.*$', '',ref_update_20210602$attributes)
View(ref_update_20210602)
# to cal the gene ID....
# We can use gsub.
# Match the pattern of one or more characters that are not a - ([^-]+) from the start (^) of the string followed by a - or (| a - followed by characters (.*) and replace it with blank ("")
ref_update_20210602$gene_ID  <- sub(" \\;Alias", '',ref_update_20210602$attributes)
View(ref_update_20210602)
# to cal the gene ID....
# We can use gsub.
# Match the pattern of one or more characters that are not a - ([^-]+) from the start (^) of the string followed by a - or (| a - followed by characters (.*) and replace it with blank ("")
ref_update_20210602$gene_ID  <- sub(" \\;Name", '',ref_update_20210602$attributes)
View(ref_update_20210602)
# to cal the gene ID....
# We can use gsub.
# Match the pattern of one or more characters that are not a - ([^-]+) from the start (^) of the string followed by a - or (| a - followed by characters (.*) and replace it with blank ("")
ref_update_20210602$gene_ID  <- sub(" \\Name", '',ref_update_20210602$attributes)
View(ref_update_20210602)
ref_update_20210602 <- read.gff("C:/Users/samjg/Documents/My_Projects/Pgenerosa_TagSeq_Metabolomics/TagSeq/Seq_details/Panopea-generosa-v1.0.a4.gene.gff3", GFF3 = TRUE) # use library(ape) to import a gff3 as a datatable
# to cal the gene ID....
# We can use gsub.
# Match the pattern of one or more characters that are not a - ([^-]+) from the start (^) of the string followed by a - or (| a - followed by characters (.*) and replace it with blank ("")
ref_update_20210602$gene_ID  <- sub(" \\Name", '',ref_update_20210602$attributes)
View(ref_update_20210602)
# to cal the gene ID....
# We can use gsub.
# Match the pattern of one or more characters that are not a - ([^-]+) from the start (^) of the string followed by a - or (| a - followed by characters (.*) and replace it with blank ("")
ref_update_20210602$gene_ID  <- subatr(ref_update_20210602$attributes, 3, 20)
# to cal the gene ID....
# We can use gsub.
# Match the pattern of one or more characters that are not a - ([^-]+) from the start (^) of the string followed by a - or (| a - followed by characters (.*) and replace it with blank ("")
ref_update_20210602$gene_ID  <- substr(ref_update_20210602$attributes, 3, 20)
ref_update_20210602$gene_ID[c(1:10)]
# to cal the gene ID....
# We can use gsub.
# Match the pattern of one or more characters that are not a - ([^-]+) from the start (^) of the string followed by a - or (| a - followed by characters (.*) and replace it with blank ("")
ref_update_20210602$gene_ID  <- substr(ref_update_20210602$attributes, 4, 18)
ref_update_20210602$gene_ID[c(1:10)]
View(ref_update_20210602)
ref_update_20210602$attributes[c(1:10)]
red_update_condenced <- ref_update_20210602 %>% dplyr::select(c('gene_ID','attributes'))
red_update_condenced <- ref_update_20210602 %>% dplyr::select(c('gene_ID','attributes'))
red_update_condenced <- ref_update_20210602 %>% dplyr::select('gene_ID','attributes')
red_update_condenced <- ref_update_20210602 %>% tidyr::select('gene_ID','attributes')
ref_update_20210602$gene_notes  <-  sub(" \\Notes.*", "", ref_update_20210602$attributes)
ref_update_20210602$gene_notes[1]
ref_update_20210602$gene_notes  <-  sub(".*Notes\\", "", ref_update_20210602$attributes)
ref_update_20210602$gene_notes  <-  sub(".*Notes//", "", ref_update_20210602$attributes)
ref_update_20210602$gene_notes[1]
red_update_condenced <- ref_update_20210602 %>% tidyr::select(c('gene_ID','attributes'))
red_update_condenced <- ref_update_20210602[c(9,9),]
red_update_condenced
red_update_condenced <- ref_update_20210602[,c(8,9)]
red_update_condenced
View(red_update_condenced)
red_update_condenced <- ref_update_20210602[,c(9,10)]
View(red_update_condenced)
red_update_condenced <- ref_update_20210602[,c(9,10)]
View(ref_update_condenced)
ref_update_condenced <- ref_update_20210602[,c(9,10)]
Geoduck_annotation <- read.delim2(file="C:/Users/samjg/Documents/My_Projects/Pgenerosa_TagSeq_Metabolomics/TagSeq/Seq_details/Panopea-generosa-genes-annotations.txt", header=F)
annot.condenced <- Geoduck_annotation[,c(1,7)] # load just the PGEN ID and the putative gene terms
annot.condenced$Gene_term    <- sub(" \\(EC.*", "", annot.condenced$V7)  # call the gene term BEFORe the EC is listed
Pgen_reference <- na.omit(annot.condenced[c(1,3)]) # ommit unannotated genes
names(Pgen_reference)  <- c('Pgenerosa_Gene_IDs', 'Gene_terms') # rename the columns to merge with the modules below...
View(Pgen_reference)
# to cal the gene ID....
# We can use gsub.
# Match the pattern of one or more characters that are not a - ([^-]+) from the start (^) of the string followed by a - or (| a - followed by characters (.*) and replace it with blank ("")
ref_update_20210602$Pgenerosa_Gene_IDs  <- substr(ref_update_20210602$attributes, 4, 18)
ref_update_20210602$gene_notes  <-  sub(".*Notes//", "", ref_update_20210602$attributes)
ref_update_20210602$gene_notes[1]
ref_update_condenced <- ref_update_20210602[,c(9,10)]
test <- merge(ref_update_condenced, Pgen_reference, by = 'Pgenerosa_Gene_IDs')
# to cal the gene ID....
# We can use gsub.
# Match the pattern of one or more characters that are not a - ([^-]+) from the start (^) of the string followed by a - or (| a - followed by characters (.*) and replace it with blank ("")
ref_update_20210602$Pgenerosa_Gene_IDs  <- substr(ref_update_20210602$attributes, 4, 18)
ref_update_20210602$gene_notes  <-  sub(".*Notes//", "", ref_update_20210602$attributes)
ref_update_condenced <- ref_update_20210602[,c(9,10)]
test <- merge(ref_update_condenced, Pgen_reference, by = 'Pgenerosa_Gene_IDs')
Pgen_reference
ref_update_condenced
View(ref_update_condenced) # 34940
# check the .gff updated reference file
ref_update_20210602 <- read.gff("C:/Users/samjg/Documents/My_Projects/Pgenerosa_TagSeq_Metabolomics/TagSeq/Seq_details/Panopea-generosa-v1.0.a4.gene.gff3", GFF3 = TRUE) # use library(ape) to import a gff3 as a datatable
# to cal the gene ID....
# We can use gsub.
# Match the pattern of one or more characters that are not a - ([^-]+) from the start (^) of the string followed by a - or (| a - followed by characters (.*) and replace it with blank ("")
ref_update_20210602$Pgenerosa_Gene_IDs  <- substr(ref_update_20210602$attributes, 4, 18)
ref_update_20210602$gene_notes  <-  sub(".*Notes//", "", ref_update_20210602$attributes)
ref_update_condenced <- ref_update_20210602[,c(9,10)]
View(ref_update_condenced) # 34940
test <- merge(ref_update_condenced, Pgen_reference, by = 'Pgenerosa_Gene_IDs')
View(test) # 34940
test <- merge(Pgen_reference, ref_update_condenced, by = 'Pgenerosa_Gene_IDs')
View(test) # 34940
